name: Vendor

on: workflow_dispatch

permissions:
  contents: write

jobs:
  libs:
    name: Libraries
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Setup Node.js environment
      uses: actions/setup-node@v3
      with:
        node-version: lts/*

    - name: Install dependencies
      run: npm ci

    - name: Copy files
      run: dev/copy-libs.sh

    - name: Configure git
      run: |
        git config --global user.name "${{ github.event.sender.name || github.event.sender.login }}"
        git config --global user.email "${{ github.event.sender.id }}+${{ github.event.sender.login }}@users.noreply.github.com"

    - name: Commit changes
      run: |
        git add src/lib/**
        git commit -m "Update vendored files"

    - name: Push
      run: git push
  ci:
    needs: libs
    uses: ./.github/workflows/ci.yml
